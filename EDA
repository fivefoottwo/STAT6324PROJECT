# 6324 Final Project
#Version 1

#Data dictionary for the heart disease dataset
#https://www.kaggle.com/datasets/kamilpytlak/personal-key-indicators-of-heart-disease

#Clear Environment
remove(list = ls())

#Add libraries
library(mice)
library(ggplot2)
library(corrplot)

#Set working directory (you can add yours and comment the rest out)
#setwd("/Users/nicoleng/Dropbox/SMU/MASDA/STAT 6324/Project") #Nicole

#Read in dataset
heart <- read.csv("/Users/allisonking/Downloads/heart_2020_cleaned.csv") #Allison

#Set seed number
set.seed(1234)

#Preliminary inspection of data
str(heart)
summary(heart)

#EDA
#Describe variables and distribution
#Ex: Comparing explanatory variables to variable:heartdisease (like race/age/diabetes etc...)
#We could also check for multicollinearity for between variables 

#Visualize missing data - no missing values!!
md.pattern(heart)
simple_aggr = aggr(heart, col=mdc(1:2), numbers=TRUE, sortVars=TRUE, labels=names(heart), cex.axis=.7, 
                   gap=3, ylab=c("Proportion of missingness","Missingness Pattern"))

#Boxplot of bmi by heart disease - outliers check
boxplot(BMI ~ HeartDisease, data=heart, horizontal=T, col=c("yellow","lightblue"), 
        main='Boxplots of BMI Score by Heart Disease Diagnosis')

#Boxplot of sleep by heart disease - outliers check
boxplot(SleepTime ~ HeartDisease, data=heart, horizontal=T, col=c("orange","green"), 
        main='Boxplots of Sleep by Heart Disease Diagnosis')

#Correlation matrix on numeric data only
num_df <- data.frame(heart$BMI, heart$PhysicalHealth, heart$MentalHealth, heart$SleepTime)
M <- cor(num_df)
corrplot(M, method="circle")

#Finding how many correlations are bigger than 0.70
k = 0
for(i in 1:4) {
  for(r in 1:4){
    if(M[i,r]> 0.70 & i != r){
      k= k + 1
    }
  }  }
print(k/2)

#Bar graph showing class distribution of heart disease column
barplot(prop.table(table(heart$HeartDisease)),
        col = rainbow(2),
        ylim = c(0, 1),
        main = "Class Distribution")

#A huge majority of the data is people who do not have heart disease. However, we're interested in those who do.
#Splitting the data and only doing further EDA on heart disease positive people
#Of those that have heart disease, what's the common theme:
dfHD <- heart[which(heart$HeartDisease == "Yes"),]

#Save a table of heart disease and smoking
HeartSmoke <- table(dfHD$HeartDisease,
                  dfHD$Smoking)

#Barplot for smoking for people who have heart disease
barplot(HeartSmoke,
        beside = TRUE,
        main = "Smoking Distribution for Heart Disease Positive People",
        xlab = "Smoker",
        ylab = "Count",
        col = c("deeppink"))

# Save a table of heart disease and alcohol
HeartAlc <- table(dfHD$HeartDisease,
                    dfHD$AlcoholDrinking)
# View the table
HeartAlc

#Barplot of alcohol consumption for people who have heart disease
barplot(HeartAlc,
        beside = TRUE,
        main = "Alcohol Distribution for Heart Disease Positive People",
        xlab = "Alcohol Drinker",
        ylab = "Count",
        col = c("green"))

# Save a table of age for people who have heart disease
HeartAge <- table(dfHD$HeartDisease,
                  dfHD$AgeCategory)
# View the table
HeartAge

#Barplot for age vs heart disease
barplot(HeartAge,
        beside = TRUE,
        main = "Age Distribution for Heart Disease Positive People",
        xlab = "Age",
        ylab = "Count",
        col = c("blue"))

# Save a table of walking and heart disease
HeartWalk <- table(dfHD$HeartDisease,
                  dfHD$DiffWalking)

#Barplot for walking for people who have heart disease
barplot(HeartWalk,
        beside = TRUE,
        main = "Difficulty Walking Distribution for Heart Disease Positive People",
        xlab = "Difficulty Walking",
        ylab = "Count",
        col = c("yellow"))

# Save a table of race and heart disease
HeartRace <- table(dfHD$HeartDisease,
                   dfHD$Race)

#Barplot for race vs heart disease
barplot(HeartRace,
        beside = TRUE,
        main = "Race Distribution for Heart Disease Positive People",
        xlab = "Race",
        ylab = "Count",
        col = c("purple"))

# Save a table of heart disease and diabetes
HeartDia <- table(dfHD$HeartDisease, dfHD$Diabetic)

#Barplot for heart disease and diabetes
barplot(HeartDia,
        beside = TRUE,
        main = "Diabetes Distribution for Heart Disease Positive People",
        xlab = "Diabetes",
        ylab = "Count",
        col = c("orange"))

# Save a table of heart disease and sex
Heartsex <- table(dfHD$HeartDisease, dfHD$Sex)

#Barplot for heart disease and diabetes
barplot(Heartsex,
        beside = TRUE,
        main = "Sex Distribution for Heart Disease Positive People",
        xlab = "Sex",
        ylab = "Count",
        col = c("deeppink"))

# Save a table of heart disease and general health
HeartGE <- table(dfHD$HeartDisease, dfHD$GenHealth)

#Barplot for heart disease and diabetes
barplot(HeartGE,
        beside = TRUE,
        main = "General Health Distribution for Heart Disease Positive People",
        xlab = "General Health",
        ylab = "Count",
        col = c("lightblue"))

# Save a table of heart disease and stroke
Heartst <- table(dfHD$HeartDisease, dfHD$Stroke)

#Barplot for heart disease and diabetes
barplot(Heartst,
        beside = TRUE,
        main = "Stroke Distribution for Heart Disease Positive People",
        xlab = "Stroke",
        ylab = "Count",
        col = c("orange"))
